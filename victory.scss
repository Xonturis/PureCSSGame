@import "string-utils";

@mixin setupVictory($secret, $level) {
    @if ($level !=1) {
        container>level-#{$level} {
            display: none;
        }
    }

    .victory-level-#{$level} {
        position: absolute;
        width: $victory-width;
        height: $victory-height;

        background: red;

        transform: translateX(calc(#{$container-width / 2} - #{$victory-width / 2})) translateY($victory-margin);
    }

    $number-of-inputs: length($secret);
    $supra-selector: "";
    $ors : ();

    @for $requirementno from 1 through $number-of-inputs {
        $value: nth($secret, $requirementno);

        @if ($value==0) {
            $supra-selector : $supra-selector+".checkbox-#{$requirementno}-level-#{$level}:not(:checked) ~ ";
        }

        @else if ($value==1) {
            $supra-selector : $supra-selector+".checkbox-#{$requirementno}-level-#{$level}:checked ~ ";
        }

        @else {
            @for $orno from $requirementno through $number-of-inputs {
                @if ($orno <=$number-of-inputs) {
                    @if nth($secret, $orno)==$value {
                        $list-of-ors: map-get($ors, $value);

                        @if not index($list-of-ors, $orno) {
                            $list-of-ors: append($list-of-ors, $orno, comma);
                            $ors: map-merge($ors, ($value : $list-of-ors));
                        }
                    }
                }
            }
        }
    }

    $or-selector: "";

    @each $pair,
    $list-of-or in $ors {

        @each $or in $list-of-or {
            @if $or {
                $or-selector : $or-selector+"#{$supra-selector}.checkbox-#{$or}-level-#{$level}:checked ~ //SELECTOR//, ";
            }
        }
    }

    @if $or-selector !="" {
        $supra-selector: $or-selector;
    }

    @else {
        $supra-selector: $supra-selector + "//SELECTOR//";
    }

    $supra-selector-victory : str-replace($supra-selector, "//SELECTOR//", "container>level-#{$level}>.victory-level-#{$level}");
    $supra-selector-level : str-replace($supra-selector, "//SELECTOR//", "container>level-#{$level}");
    $supra-selector-next-level : str-replace($supra-selector, "//SELECTOR//", "container>level-#{$level + 1}");
    $supra-selector-container : str-replace($supra-selector, "//SELECTOR//", "container");

    #{$supra-selector-level} {
        display: none;
        animation: 2s ease-in-out 3s 1 disappear forwards;
    }

    #{$supra-selector-next-level} {
        display: inline;
        animation: 2s ease-in-out 3s 1 appear;
    }

    #{$supra-selector-victory} {
        background-color: green;
    }

}